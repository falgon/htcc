<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">{-|
Module      : Htcc.Asm.Intrinsic.Structure.Internal
Description : The modules of intrinsic (x86_64) assembly
Copyright   : (c) roki, 2019
License     : MIT
Maintainer  : falgon53@yahoo.co.jp
Stability   : experimental
Portability : POSIX

The modules of intrinsic (x86_64) assembly
-}</span><span>
</span><span id="line-12"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings, TupleSections #-}</span><span>
</span><span id="line-13"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Htcc.Asm.Intrinsic.Structure.Internal</span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-14"></span><span>    </span><span class="annot"><a href="Htcc.Asm.Intrinsic.Structure.Internal.html#Asm"><span class="hs-identifier">Asm</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-15"></span><span>    </span><span class="annot"><a href="Htcc.Asm.Intrinsic.Structure.Internal.html#AsmInfo"><span class="hs-identifier">AsmInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-16"></span><span>    </span><span class="annot"><a href="Htcc.Asm.Intrinsic.Structure.Internal.html#AsmCodeCtx"><span class="hs-identifier">AsmCodeCtx</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-17"></span><span>    </span><span class="annot"><a href="Htcc.Asm.Intrinsic.Structure.Internal.html#unCtx"><span class="hs-identifier">unCtx</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-18"></span><span>    </span><span class="annot"><a href="Htcc.Asm.Intrinsic.Structure.Internal.html#runAsm"><span class="hs-identifier">runAsm</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-19"></span><span>    </span><span class="annot"><a href="Htcc.Asm.Intrinsic.Structure.Internal.html#putStrWithIndent"><span class="hs-identifier">putStrWithIndent</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-20"></span><span>    </span><span class="annot"><a href="Htcc.Asm.Intrinsic.Structure.Internal.html#putStrLnWithIndent"><span class="hs-identifier">putStrLnWithIndent</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-21"></span><span>    </span><span class="annot"><a href="Htcc.Asm.Intrinsic.Structure.Internal.html#errCtx"><span class="hs-identifier">errCtx</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-22"></span><span>    </span><span class="annot"><a href="Htcc.Asm.Intrinsic.Structure.Internal.html#writeCurFn"><span class="hs-identifier">writeCurFn</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-23"></span><span>    </span><span class="annot"><a href="Htcc.Asm.Intrinsic.Structure.Internal.html#section"><span class="hs-identifier">section</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-24"></span><span>    </span><span class="annot"><a href="Htcc.Asm.Intrinsic.Structure.Internal.html#labeled"><span class="hs-identifier">labeled</span></a></span><span>
</span><span id="line-25"></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-26"></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Control.Monad.Finally</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">MonadFinally</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.IORef</span></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">IORef</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">newIORef</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">writeIORef</span></span><span class="hs-special">)</span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span>             </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text.IO</span></span><span>          </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-31"></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Htcc.Utils.html"><span class="hs-identifier">Htcc.Utils</span></a></span><span>            </span><span class="hs-special">(</span><span class="annot"><a href="Htcc.Utils.Print.html#err"><span class="hs-identifier">err</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-33"></span><span>
</span><span id="line-34"></span><span class="hs-comment">-- | Counter and label information used when generating assembly code</span><span>
</span><span id="line-35"></span><span class="hs-keyword">data</span><span> </span><span id="AsmInfo"><span class="annot"><a href="Htcc.Asm.Intrinsic.Structure.Internal.html#AsmInfo"><span class="hs-identifier hs-var">AsmInfo</span></a></span></span><span> </span><span id="local-6989586621679292356"><span class="annot"><a href="#local-6989586621679292356"><span class="hs-identifier hs-type">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="AsmInfo"><span class="annot"><a href="Htcc.Asm.Intrinsic.Structure.Internal.html#AsmInfo"><span class="hs-identifier hs-var">AsmInfo</span></a></span></span><span>
</span><span id="line-36"></span><span>    </span><span class="hs-special">{</span><span>
</span><span id="line-37"></span><span>        </span><span id="inLabel"><span class="annot"><span class="annottext">AsmInfo e -&gt; Bool
</span><a href="Htcc.Asm.Intrinsic.Structure.Internal.html#inLabel"><span class="hs-identifier hs-var hs-var">inLabel</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- ^ the flag that indicates whether it is inside the label. If True, indent by single tab,</span><span>
</span><span id="line-38"></span><span>        </span><span id="lblCnt"><span class="annot"><span class="annottext">AsmInfo e -&gt; IORef e
</span><a href="Htcc.Asm.Intrinsic.Structure.Internal.html#lblCnt"><span class="hs-identifier hs-var hs-var">lblCnt</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IORef</span></span><span> </span><span class="annot"><a href="#local-6989586621679292356"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- ^ the label counter</span><span>
</span><span id="line-39"></span><span>        </span><span id="brkCnt"><span class="annot"><span class="annottext">AsmInfo e -&gt; IORef (Maybe e)
</span><a href="Htcc.Asm.Intrinsic.Structure.Internal.html#brkCnt"><span class="hs-identifier hs-var hs-var">brkCnt</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IORef</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621679292356"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- ^ the @break@ label counter</span><span>
</span><span id="line-40"></span><span>        </span><span id="cntCnt"><span class="annot"><span class="annottext">AsmInfo e -&gt; IORef (Maybe e)
</span><a href="Htcc.Asm.Intrinsic.Structure.Internal.html#cntCnt"><span class="hs-identifier hs-var hs-var">cntCnt</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IORef</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621679292356"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- ^ the @continue@ label counter</span><span>
</span><span id="line-41"></span><span>        </span><span id="curFn"><span class="annot"><span class="annottext">AsmInfo e -&gt; IORef (Maybe Text)
</span><a href="Htcc.Asm.Intrinsic.Structure.Internal.html#curFn"><span class="hs-identifier hs-var hs-var">curFn</span></a></span></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IORef</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ the function being processed</span><span>
</span><span id="line-42"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-43"></span><span>
</span><span id="line-44"></span><span class="hs-comment">-- | A monad that represents the context of the assembly code</span><span>
</span><span id="line-45"></span><span class="hs-keyword">newtype</span><span> </span><span id="Asm"><span class="annot"><a href="Htcc.Asm.Intrinsic.Structure.Internal.html#Asm"><span class="hs-identifier hs-var">Asm</span></a></span></span><span> </span><span id="local-6989586621679292452"><span class="annot"><a href="#local-6989586621679292452"><span class="hs-identifier hs-type">ctx</span></a></span></span><span> </span><span id="local-6989586621679292454"><span class="annot"><a href="#local-6989586621679292454"><span class="hs-identifier hs-type">e</span></a></span></span><span> </span><span id="local-6989586621679292453"><span class="annot"><a href="#local-6989586621679292453"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Asm"><span class="annot"><a href="Htcc.Asm.Intrinsic.Structure.Internal.html#Asm"><span class="hs-identifier hs-var">Asm</span></a></span></span><span>
</span><span id="line-46"></span><span>    </span><span class="hs-special">{</span><span>
</span><span id="line-47"></span><span>        </span><span id="unAsm"><span class="annot"><span class="annottext">Asm ctx e a -&gt; AsmInfo e -&gt; IO a
</span><a href="Htcc.Asm.Intrinsic.Structure.Internal.html#unAsm"><span class="hs-identifier hs-var hs-var">unAsm</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Htcc.Asm.Intrinsic.Structure.Internal.html#AsmInfo"><span class="hs-identifier hs-type">AsmInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679292454"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679292453"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-comment">-- ^ Function that determines the structure of assembly code</span><span>
</span><span id="line-48"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-49"></span><span>
</span><span id="line-50"></span><span id="local-6989586621679292314"><span id="local-6989586621679292315"><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679292311"><span class="annot"><span class="hs-identifier hs-type">Functor</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Htcc.Asm.Intrinsic.Structure.Internal.html#Asm"><span class="hs-identifier hs-type">Asm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679292315"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679292314"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-51"></span><span>    </span><span id="local-6989586621679292309"><span class="annot"><span class="annottext">fmap :: (a -&gt; b) -&gt; Asm ctx e a -&gt; Asm ctx e b
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">fmap</span></span></span><span> </span><span id="local-6989586621679292308"><span class="annot"><span class="annottext">f :: a -&gt; b
</span><a href="#local-6989586621679292308"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679292307"><span class="annot"><span class="annottext">asm :: Asm ctx e a
</span><a href="#local-6989586621679292307"><span class="hs-identifier hs-var">asm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(AsmInfo e -&gt; IO b) -&gt; Asm ctx e b
forall ctx e a. (AsmInfo e -&gt; IO a) -&gt; Asm ctx e a
</span><a href="Htcc.Asm.Intrinsic.Structure.Internal.html#Asm"><span class="hs-identifier hs-var">Asm</span></a></span><span> </span><span class="annot"><span class="annottext">((AsmInfo e -&gt; IO b) -&gt; Asm ctx e b)
-&gt; (AsmInfo e -&gt; IO b) -&gt; Asm ctx e b
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(a -&gt; b) -&gt; IO a -&gt; IO b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; b
</span><a href="#local-6989586621679292308"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">(IO a -&gt; IO b) -&gt; (AsmInfo e -&gt; IO a) -&gt; AsmInfo e -&gt; IO b
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Asm ctx e a -&gt; AsmInfo e -&gt; IO a
forall ctx e a. Asm ctx e a -&gt; AsmInfo e -&gt; IO a
</span><a href="Htcc.Asm.Intrinsic.Structure.Internal.html#unAsm"><span class="hs-identifier hs-var hs-var">unAsm</span></a></span><span> </span><span class="annot"><span class="annottext">Asm ctx e a
</span><a href="#local-6989586621679292307"><span class="hs-identifier hs-var">asm</span></a></span></span></span><span>
</span><span id="line-52"></span><span>
</span><span id="line-53"></span><span id="local-6989586621679292304"><span id="local-6989586621679292305"><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679292295"><span id="local-6989586621679292297"><span id="local-6989586621679292299"><span class="annot"><span class="hs-identifier hs-type">Applicative</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Htcc.Asm.Intrinsic.Structure.Internal.html#Asm"><span class="hs-identifier hs-type">Asm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679292305"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679292304"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">)</span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-54"></span><span>    </span><span id="local-6989586621679292293"><span class="annot"><span class="annottext">pure :: a -&gt; Asm ctx e a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">pure</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(AsmInfo e -&gt; IO a) -&gt; Asm ctx e a
forall ctx e a. (AsmInfo e -&gt; IO a) -&gt; Asm ctx e a
</span><a href="Htcc.Asm.Intrinsic.Structure.Internal.html#Asm"><span class="hs-identifier hs-var">Asm</span></a></span><span> </span><span class="annot"><span class="annottext">((AsmInfo e -&gt; IO a) -&gt; Asm ctx e a)
-&gt; (a -&gt; AsmInfo e -&gt; IO a) -&gt; a -&gt; Asm ctx e a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">IO a -&gt; AsmInfo e -&gt; IO a
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">(IO a -&gt; AsmInfo e -&gt; IO a)
-&gt; (a -&gt; IO a) -&gt; a -&gt; AsmInfo e -&gt; IO a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span>
</span><span id="line-55"></span><span>    </span><span id="local-6989586621679292291"><span class="annot"><span class="annottext">f :: Asm ctx e (a -&gt; b)
</span><a href="#local-6989586621679292291"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679292290"><span class="annot"><span class="annottext">&lt;*&gt; :: Asm ctx e (a -&gt; b) -&gt; Asm ctx e a -&gt; Asm ctx e b
</span><span class="hs-operator hs-var hs-var hs-var hs-var">&lt;*&gt;</span></span></span><span> </span><span id="local-6989586621679292289"><span class="annot"><span class="annottext">x :: Asm ctx e a
</span><a href="#local-6989586621679292289"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(AsmInfo e -&gt; IO b) -&gt; Asm ctx e b
forall ctx e a. (AsmInfo e -&gt; IO a) -&gt; Asm ctx e a
</span><a href="Htcc.Asm.Intrinsic.Structure.Internal.html#Asm"><span class="hs-identifier hs-var">Asm</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679292288"><span class="annot"><span class="annottext">ai :: AsmInfo e
</span><a href="#local-6989586621679292288"><span class="hs-identifier hs-var">ai</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Asm ctx e (a -&gt; b) -&gt; AsmInfo e -&gt; IO (a -&gt; b)
forall ctx e a. Asm ctx e a -&gt; AsmInfo e -&gt; IO a
</span><a href="Htcc.Asm.Intrinsic.Structure.Internal.html#unAsm"><span class="hs-identifier hs-var hs-var">unAsm</span></a></span><span> </span><span class="annot"><span class="annottext">Asm ctx e (a -&gt; b)
</span><a href="#local-6989586621679292291"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">AsmInfo e
</span><a href="#local-6989586621679292288"><span class="hs-identifier hs-var">ai</span></a></span><span> </span><span class="annot"><span class="annottext">IO (a -&gt; b) -&gt; IO a -&gt; IO b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Asm ctx e a -&gt; AsmInfo e -&gt; IO a
forall ctx e a. Asm ctx e a -&gt; AsmInfo e -&gt; IO a
</span><a href="Htcc.Asm.Intrinsic.Structure.Internal.html#unAsm"><span class="hs-identifier hs-var hs-var">unAsm</span></a></span><span> </span><span class="annot"><span class="annottext">Asm ctx e a
</span><a href="#local-6989586621679292289"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">AsmInfo e
</span><a href="#local-6989586621679292288"><span class="hs-identifier hs-var">ai</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-56"></span><span>
</span><span id="line-57"></span><span id="local-6989586621679292286"><span id="local-6989586621679292287"><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679292282"><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Htcc.Asm.Intrinsic.Structure.Internal.html#Asm"><span class="hs-identifier hs-type">Asm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679292287"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679292286"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-58"></span><span>    </span><span id="local-6989586621679292279"><span class="annot"><span class="annottext">return :: a -&gt; Asm ctx e a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">return</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; Asm ctx e a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span>
</span><span id="line-59"></span><span>    </span><span id="local-6989586621679292278"><span class="annot"><span class="annottext">x :: Asm ctx e a
</span><a href="#local-6989586621679292278"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679292277"><span class="annot"><span class="annottext">&gt;&gt;= :: Asm ctx e a -&gt; (a -&gt; Asm ctx e b) -&gt; Asm ctx e b
</span><span class="hs-operator hs-var hs-var hs-var hs-var">&gt;&gt;=</span></span></span><span> </span><span id="local-6989586621679292276"><span class="annot"><span class="annottext">f :: a -&gt; Asm ctx e b
</span><a href="#local-6989586621679292276"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(AsmInfo e -&gt; IO b) -&gt; Asm ctx e b
forall ctx e a. (AsmInfo e -&gt; IO a) -&gt; Asm ctx e a
</span><a href="Htcc.Asm.Intrinsic.Structure.Internal.html#Asm"><span class="hs-identifier hs-var">Asm</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679292275"><span class="annot"><span class="annottext">ai :: AsmInfo e
</span><a href="#local-6989586621679292275"><span class="hs-identifier hs-var">ai</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Asm ctx e a -&gt; AsmInfo e -&gt; IO a
forall ctx e a. Asm ctx e a -&gt; AsmInfo e -&gt; IO a
</span><a href="Htcc.Asm.Intrinsic.Structure.Internal.html#unAsm"><span class="hs-identifier hs-var hs-var">unAsm</span></a></span><span> </span><span class="annot"><span class="annottext">Asm ctx e a
</span><a href="#local-6989586621679292278"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">AsmInfo e
</span><a href="#local-6989586621679292275"><span class="hs-identifier hs-var">ai</span></a></span><span> </span><span class="annot"><span class="annottext">IO a -&gt; (a -&gt; IO b) -&gt; IO b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">(Asm ctx e b -&gt; AsmInfo e -&gt; IO b)
-&gt; AsmInfo e -&gt; Asm ctx e b -&gt; IO b
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">Asm ctx e b -&gt; AsmInfo e -&gt; IO b
forall ctx e a. Asm ctx e a -&gt; AsmInfo e -&gt; IO a
</span><a href="Htcc.Asm.Intrinsic.Structure.Internal.html#unAsm"><span class="hs-identifier hs-var hs-var">unAsm</span></a></span><span> </span><span class="annot"><span class="annottext">AsmInfo e
</span><a href="#local-6989586621679292275"><span class="hs-identifier hs-var">ai</span></a></span><span> </span><span class="annot"><span class="annottext">(Asm ctx e b -&gt; IO b) -&gt; (a -&gt; Asm ctx e b) -&gt; a -&gt; IO b
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; Asm ctx e b
</span><a href="#local-6989586621679292276"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-60"></span><span>
</span><span id="line-61"></span><span id="local-6989586621679292272"><span id="local-6989586621679292273"><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679292263"><span id="local-6989586621679292266"><span id="local-6989586621679292268"><span class="annot"><span class="hs-identifier hs-type">MonadFinally</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Htcc.Asm.Intrinsic.Structure.Internal.html#Asm"><span class="hs-identifier hs-type">Asm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679292273"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679292272"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">)</span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-62"></span><span>    </span><span id="local-6989586621679292261"><span class="annot"><span class="annottext">bracket' :: Asm ctx e r
-&gt; (r -&gt; Maybe &#945; -&gt; Asm ctx e &#946;)
-&gt; (r -&gt; Asm ctx e &#945;)
-&gt; Asm ctx e (&#945;, &#946;)
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">bracket'</span></span></span><span> </span><span id="local-6989586621679292259"><span class="annot"><span class="annottext">a :: Asm ctx e r
</span><a href="#local-6989586621679292259"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621679292258"><span class="annot"><span class="annottext">r :: r -&gt; Maybe &#945; -&gt; Asm ctx e &#946;
</span><a href="#local-6989586621679292258"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621679292257"><span class="annot"><span class="annottext">mc :: r -&gt; Asm ctx e &#945;
</span><a href="#local-6989586621679292257"><span class="hs-identifier hs-var">mc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-63"></span><span>        </span><span id="local-6989586621679292256"><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621679292256"><span class="hs-identifier hs-var">r'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Asm ctx e r
</span><a href="#local-6989586621679292259"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-64"></span><span>        </span><span id="local-6989586621679292255"><span class="annot"><span class="annottext">&#945;
</span><a href="#local-6989586621679292255"><span class="hs-identifier hs-var">a'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">r -&gt; Asm ctx e &#945;
</span><a href="#local-6989586621679292257"><span class="hs-identifier hs-var">mc</span></a></span><span> </span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621679292256"><span class="hs-identifier hs-var">r'</span></a></span><span>
</span><span id="line-65"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">&#945;
</span><a href="#local-6989586621679292255"><span class="hs-identifier hs-var">a'</span></a></span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(&#946; -&gt; (&#945;, &#946;)) -&gt; Asm ctx e &#946; -&gt; Asm ctx e (&#945;, &#946;)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">r -&gt; Maybe &#945; -&gt; Asm ctx e &#946;
</span><a href="#local-6989586621679292258"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621679292256"><span class="hs-identifier hs-var">r'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">&#945; -&gt; Maybe &#945;
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">&#945;
</span><a href="#local-6989586621679292255"><span class="hs-identifier hs-var">a'</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-66"></span><span>
</span><span id="line-67"></span><span id="local-6989586621679292251"><span id="local-6989586621679292252"><span id="local-6989586621679292253"><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679292246"><span id="local-6989586621679292248"><span class="annot"><span class="hs-identifier hs-type">Semigroup</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Htcc.Asm.Intrinsic.Structure.Internal.html#Asm"><span class="hs-identifier hs-type">Asm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679292253"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679292252"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679292251"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-68"></span><span>    </span><span id="local-6989586621679292244"><span class="annot"><span class="annottext">&lt;&gt; :: Asm ctx e a -&gt; Asm ctx e a -&gt; Asm ctx e a
</span><span class="hs-operator hs-var hs-var hs-var hs-var">(&lt;&gt;)</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Asm ctx e a -&gt; Asm ctx e a -&gt; Asm ctx e a
forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b -&gt; f b
</span><span class="hs-operator hs-var">(*&gt;)</span></span></span></span></span><span>
</span><span id="line-69"></span><span>
</span><span id="line-70"></span><span id="local-6989586621679292241"><span id="local-6989586621679292242"><span id="local-6989586621679292243"><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679292236"><span class="annot"><span class="hs-identifier hs-type">Monoid</span></span><span> </span><span class="annot"><a href="#local-6989586621679292243"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monoid</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Htcc.Asm.Intrinsic.Structure.Internal.html#Asm"><span class="hs-identifier hs-type">Asm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679292242"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679292241"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679292243"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-71"></span><span>    </span><span id="local-6989586621679292234"><span class="annot"><span class="annottext">mempty :: Asm ctx e a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">mempty</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(AsmInfo e -&gt; IO a) -&gt; Asm ctx e a
forall ctx e a. (AsmInfo e -&gt; IO a) -&gt; Asm ctx e a
</span><a href="Htcc.Asm.Intrinsic.Structure.Internal.html#Asm"><span class="hs-identifier hs-var">Asm</span></a></span><span> </span><span class="annot"><span class="annottext">((AsmInfo e -&gt; IO a) -&gt; Asm ctx e a)
-&gt; (AsmInfo e -&gt; IO a) -&gt; Asm ctx e a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">IO a -&gt; AsmInfo e -&gt; IO a
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">(IO a -&gt; AsmInfo e -&gt; IO a) -&gt; IO a -&gt; AsmInfo e -&gt; IO a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">a
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-72"></span><span>    </span><span id="local-6989586621679292233"><span class="annot"><span class="annottext">mappend :: Asm ctx e a -&gt; Asm ctx e a -&gt; Asm ctx e a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">mappend</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Asm ctx e a -&gt; Asm ctx e a -&gt; Asm ctx e a
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">(&lt;&gt;)</span></span></span></span></span><span>
</span><span id="line-73"></span><span>
</span><span id="line-74"></span><span class="hs-comment">-- | Type representing assembly code</span><span>
</span><span id="line-75"></span><span class="hs-keyword">data</span><span> </span><span id="AsmCodeCtx"><span class="annot"><a href="Htcc.Asm.Intrinsic.Structure.Internal.html#AsmCodeCtx"><span class="hs-identifier hs-var">AsmCodeCtx</span></a></span></span><span>
</span><span id="line-76"></span><span>
</span><span id="line-77"></span><span class="hs-comment">-- | the function to switch context</span><span>
</span><span id="line-78"></span><span id="local-6989586621679292338"><span id="local-6989586621679292339"><span id="local-6989586621679292340"><span id="local-6989586621679292341"><span class="annot"><a href="Htcc.Asm.Intrinsic.Structure.Internal.html#unCtx"><span class="hs-identifier hs-type">unCtx</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Htcc.Asm.Intrinsic.Structure.Internal.html#Asm"><span class="hs-identifier hs-type">Asm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679292341"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679292340"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679292339"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Htcc.Asm.Intrinsic.Structure.Internal.html#Asm"><span class="hs-identifier hs-type">Asm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679292338"><span class="hs-identifier hs-type">ctx'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679292340"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679292339"><span class="hs-identifier hs-type">a</span></a></span></span></span></span></span><span>
</span><span id="line-79"></span><span id="unCtx"><span class="annot"><span class="annottext">unCtx :: Asm ctx e a -&gt; Asm ctx' e a
</span><a href="Htcc.Asm.Intrinsic.Structure.Internal.html#unCtx"><span class="hs-identifier hs-var hs-var">unCtx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(AsmInfo e -&gt; IO a) -&gt; Asm ctx' e a
forall ctx e a. (AsmInfo e -&gt; IO a) -&gt; Asm ctx e a
</span><a href="Htcc.Asm.Intrinsic.Structure.Internal.html#Asm"><span class="hs-identifier hs-var">Asm</span></a></span><span> </span><span class="annot"><span class="annottext">((AsmInfo e -&gt; IO a) -&gt; Asm ctx' e a)
-&gt; (Asm ctx e a -&gt; AsmInfo e -&gt; IO a)
-&gt; Asm ctx e a
-&gt; Asm ctx' e a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Asm ctx e a -&gt; AsmInfo e -&gt; IO a
forall ctx e a. Asm ctx e a -&gt; AsmInfo e -&gt; IO a
</span><a href="Htcc.Asm.Intrinsic.Structure.Internal.html#unAsm"><span class="hs-identifier hs-var hs-var">unAsm</span></a></span><span>
</span><span id="line-80"></span><span>
</span><span id="line-81"></span><span class="hs-comment">-- | the executor that outputs assembly code</span><span>
</span><span id="line-82"></span><span id="local-6989586621679292231"><span id="local-6989586621679292232"><span class="annot"><a href="Htcc.Asm.Intrinsic.Structure.Internal.html#runAsm"><span class="hs-identifier hs-type">runAsm</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Num</span></span><span> </span><span class="annot"><a href="#local-6989586621679292232"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Enum</span></span><span> </span><span class="annot"><a href="#local-6989586621679292232"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Htcc.Asm.Intrinsic.Structure.Internal.html#Asm"><span class="hs-identifier hs-type">Asm</span></a></span><span> </span><span class="annot"><a href="Htcc.Asm.Intrinsic.Structure.Internal.html#AsmCodeCtx"><span class="hs-identifier hs-type">AsmCodeCtx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679292232"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679292231"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679292231"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-83"></span><span id="runAsm"><span class="annot"><span class="annottext">runAsm :: Asm AsmCodeCtx e a -&gt; IO a
</span><a href="Htcc.Asm.Intrinsic.Structure.Internal.html#runAsm"><span class="hs-identifier hs-var hs-var">runAsm</span></a></span></span><span> </span><span id="local-6989586621679292230"><span class="annot"><span class="annottext">asm :: Asm AsmCodeCtx e a
</span><a href="#local-6989586621679292230"><span class="hs-identifier hs-var">asm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-84"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="annot"><span class="hs-string">&quot;.intel_syntax noprefix&quot;</span></span><span>
</span><span id="line-85"></span><span>    </span><span id="local-6989586621679292228"><span class="annot"><span class="annottext">IORef e
</span><a href="#local-6989586621679292228"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">e -&gt; IO (IORef e)
forall a. a -&gt; IO (IORef a)
</span><span class="hs-identifier hs-var">newIORef</span></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span>
</span><span id="line-86"></span><span>    </span><span id="local-6989586621679292227"><span class="annot"><span class="annottext">IORef (Maybe e)
</span><a href="#local-6989586621679292227"><span class="hs-identifier hs-var">brk</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe e -&gt; IO (IORef (Maybe e))
forall a. a -&gt; IO (IORef a)
</span><span class="hs-identifier hs-var">newIORef</span></span><span> </span><span class="annot"><span class="annottext">Maybe e
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-87"></span><span>    </span><span id="local-6989586621679292226"><span class="annot"><span class="annottext">IORef (Maybe e)
</span><a href="#local-6989586621679292226"><span class="hs-identifier hs-var">cnt</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe e -&gt; IO (IORef (Maybe e))
forall a. a -&gt; IO (IORef a)
</span><span class="hs-identifier hs-var">newIORef</span></span><span> </span><span class="annot"><span class="annottext">Maybe e
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-88"></span><span>    </span><span id="local-6989586621679292225"><span class="annot"><span class="annottext">IORef (Maybe Text)
</span><a href="#local-6989586621679292225"><span class="hs-identifier hs-var">fn</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe Text -&gt; IO (IORef (Maybe Text))
forall a. a -&gt; IO (IORef a)
</span><span class="hs-identifier hs-var">newIORef</span></span><span> </span><span class="annot"><span class="annottext">Maybe Text
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-89"></span><span>    </span><span class="annot"><span class="annottext">Asm AsmCodeCtx e a -&gt; AsmInfo e -&gt; IO a
forall ctx e a. Asm ctx e a -&gt; AsmInfo e -&gt; IO a
</span><a href="Htcc.Asm.Intrinsic.Structure.Internal.html#unAsm"><span class="hs-identifier hs-var hs-var">unAsm</span></a></span><span> </span><span class="annot"><span class="annottext">Asm AsmCodeCtx e a
</span><a href="#local-6989586621679292230"><span class="hs-identifier hs-var">asm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
-&gt; IORef e
-&gt; IORef (Maybe e)
-&gt; IORef (Maybe e)
-&gt; IORef (Maybe Text)
-&gt; AsmInfo e
forall e.
Bool
-&gt; IORef e
-&gt; IORef (Maybe e)
-&gt; IORef (Maybe e)
-&gt; IORef (Maybe Text)
-&gt; AsmInfo e
</span><a href="Htcc.Asm.Intrinsic.Structure.Internal.html#AsmInfo"><span class="hs-identifier hs-var">AsmInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">IORef e
</span><a href="#local-6989586621679292228"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">IORef (Maybe e)
</span><a href="#local-6989586621679292227"><span class="hs-identifier hs-var">brk</span></a></span><span> </span><span class="annot"><span class="annottext">IORef (Maybe e)
</span><a href="#local-6989586621679292226"><span class="hs-identifier hs-var">cnt</span></a></span><span> </span><span class="annot"><span class="annottext">IORef (Maybe Text)
</span><a href="#local-6989586621679292225"><span class="hs-identifier hs-var">fn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-90"></span><span>
</span><span id="line-91"></span><span class="hs-comment">-- | print a string with indentation, output is broken on a new line</span><span>
</span><span id="line-92"></span><span id="local-6989586621679292342"><span id="local-6989586621679292343"><span class="annot"><a href="Htcc.Asm.Intrinsic.Structure.Internal.html#putStrLnWithIndent"><span class="hs-identifier hs-type">putStrLnWithIndent</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Htcc.Asm.Intrinsic.Structure.Internal.html#Asm"><span class="hs-identifier hs-type">Asm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679292343"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679292342"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-93"></span><span id="putStrLnWithIndent"><span class="annot"><span class="annottext">putStrLnWithIndent :: Text -&gt; Asm ctx e ()
</span><a href="Htcc.Asm.Intrinsic.Structure.Internal.html#putStrLnWithIndent"><span class="hs-identifier hs-var hs-var">putStrLnWithIndent</span></a></span></span><span> </span><span id="local-6989586621679292224"><span class="annot"><span class="annottext">s :: Text
</span><a href="#local-6989586621679292224"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(AsmInfo e -&gt; IO ()) -&gt; Asm ctx e ()
forall ctx e a. (AsmInfo e -&gt; IO a) -&gt; Asm ctx e a
</span><a href="Htcc.Asm.Intrinsic.Structure.Internal.html#Asm"><span class="hs-identifier hs-var">Asm</span></a></span><span> </span><span class="annot"><span class="annottext">((AsmInfo e -&gt; IO ()) -&gt; Asm ctx e ())
-&gt; (AsmInfo e -&gt; IO ()) -&gt; Asm ctx e ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679292223"><span class="annot"><span class="annottext">x :: AsmInfo e
</span><a href="#local-6989586621679292223"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; IO ()
</span><span class="hs-identifier hs-var">T.putStrLn</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; IO ()) -&gt; Text -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">AsmInfo e -&gt; Bool
forall e. AsmInfo e -&gt; Bool
</span><a href="Htcc.Asm.Intrinsic.Structure.Internal.html#inLabel"><span class="hs-identifier hs-var hs-var">inLabel</span></a></span><span> </span><span class="annot"><span class="annottext">AsmInfo e
</span><a href="#local-6989586621679292223"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="hs-char">'\t'</span></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Text -&gt; Text
</span><span class="hs-operator hs-var">`T.cons`</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679292224"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679292224"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-94"></span><span>
</span><span id="line-95"></span><span class="hs-comment">-- | print a string with indentation</span><span>
</span><span id="line-96"></span><span id="local-6989586621679292219"><span id="local-6989586621679292220"><span class="annot"><a href="Htcc.Asm.Intrinsic.Structure.Internal.html#putStrWithIndent"><span class="hs-identifier hs-type">putStrWithIndent</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Htcc.Asm.Intrinsic.Structure.Internal.html#Asm"><span class="hs-identifier hs-type">Asm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679292220"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679292219"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-97"></span><span id="putStrWithIndent"><span class="annot"><span class="annottext">putStrWithIndent :: Text -&gt; Asm ctx e ()
</span><a href="Htcc.Asm.Intrinsic.Structure.Internal.html#putStrWithIndent"><span class="hs-identifier hs-var hs-var">putStrWithIndent</span></a></span></span><span> </span><span id="local-6989586621679292218"><span class="annot"><span class="annottext">s :: Text
</span><a href="#local-6989586621679292218"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(AsmInfo e -&gt; IO ()) -&gt; Asm ctx e ()
forall ctx e a. (AsmInfo e -&gt; IO a) -&gt; Asm ctx e a
</span><a href="Htcc.Asm.Intrinsic.Structure.Internal.html#Asm"><span class="hs-identifier hs-var">Asm</span></a></span><span> </span><span class="annot"><span class="annottext">((AsmInfo e -&gt; IO ()) -&gt; Asm ctx e ())
-&gt; (AsmInfo e -&gt; IO ()) -&gt; Asm ctx e ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679292217"><span class="annot"><span class="annottext">x :: AsmInfo e
</span><a href="#local-6989586621679292217"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; IO ()
</span><span class="hs-identifier hs-var">T.putStr</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; IO ()) -&gt; Text -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">AsmInfo e -&gt; Bool
forall e. AsmInfo e -&gt; Bool
</span><a href="Htcc.Asm.Intrinsic.Structure.Internal.html#inLabel"><span class="hs-identifier hs-var hs-var">inLabel</span></a></span><span> </span><span class="annot"><span class="annottext">AsmInfo e
</span><a href="#local-6989586621679292217"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="hs-char">'\t'</span></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Text -&gt; Text
</span><span class="hs-operator hs-var">`T.cons`</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679292218"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679292218"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-98"></span><span>
</span><span id="line-99"></span><span class="hs-comment">-- | The error context.</span><span>
</span><span id="line-100"></span><span class="hs-comment">-- when this is executed,</span><span>
</span><span id="line-101"></span><span class="hs-comment">-- it will exit the application immediately with `System.Exit.exitFailure` after printing the message.</span><span>
</span><span id="line-102"></span><span id="local-6989586621679292214"><span id="local-6989586621679292215"><span class="annot"><a href="Htcc.Asm.Intrinsic.Structure.Internal.html#errCtx"><span class="hs-identifier hs-type">errCtx</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Htcc.Asm.Intrinsic.Structure.Internal.html#Asm"><span class="hs-identifier hs-type">Asm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679292215"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679292214"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-103"></span><span id="errCtx"><span class="annot"><span class="annottext">errCtx :: Text -&gt; Asm ctx e ()
</span><a href="Htcc.Asm.Intrinsic.Structure.Internal.html#errCtx"><span class="hs-identifier hs-var hs-var">errCtx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(AsmInfo e -&gt; IO ()) -&gt; Asm ctx e ()
forall ctx e a. (AsmInfo e -&gt; IO a) -&gt; Asm ctx e a
</span><a href="Htcc.Asm.Intrinsic.Structure.Internal.html#Asm"><span class="hs-identifier hs-var">Asm</span></a></span><span> </span><span class="annot"><span class="annottext">((AsmInfo e -&gt; IO ()) -&gt; Asm ctx e ())
-&gt; (Text -&gt; AsmInfo e -&gt; IO ()) -&gt; Text -&gt; Asm ctx e ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">IO () -&gt; AsmInfo e -&gt; IO ()
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; AsmInfo e -&gt; IO ())
-&gt; (Text -&gt; IO ()) -&gt; Text -&gt; AsmInfo e -&gt; IO ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; IO ()
</span><a href="Htcc.Utils.Print.html#err"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-104"></span><span>
</span><span id="line-105"></span><span class="hs-comment">-- | rewriting functions during processing</span><span>
</span><span id="line-106"></span><span id="local-6989586621679292212"><span id="local-6989586621679292213"><span class="annot"><a href="Htcc.Asm.Intrinsic.Structure.Internal.html#writeCurFn"><span class="hs-identifier hs-type">writeCurFn</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Htcc.Asm.Intrinsic.Structure.Internal.html#Asm"><span class="hs-identifier hs-type">Asm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679292213"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679292212"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-107"></span><span id="writeCurFn"><span class="annot"><span class="annottext">writeCurFn :: Maybe Text -&gt; Asm ctx e ()
</span><a href="Htcc.Asm.Intrinsic.Structure.Internal.html#writeCurFn"><span class="hs-identifier hs-var hs-var">writeCurFn</span></a></span></span><span> </span><span id="local-6989586621679292211"><span class="annot"><span class="annottext">fname :: Maybe Text
</span><a href="#local-6989586621679292211"><span class="hs-identifier hs-var">fname</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(AsmInfo e -&gt; IO ()) -&gt; Asm ctx e ()
forall ctx e a. (AsmInfo e -&gt; IO a) -&gt; Asm ctx e a
</span><a href="Htcc.Asm.Intrinsic.Structure.Internal.html#Asm"><span class="hs-identifier hs-var">Asm</span></a></span><span> </span><span class="annot"><span class="annottext">((AsmInfo e -&gt; IO ()) -&gt; Asm ctx e ())
-&gt; (AsmInfo e -&gt; IO ()) -&gt; Asm ctx e ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679292210"><span class="annot"><span class="annottext">x :: AsmInfo e
</span><a href="#local-6989586621679292210"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IORef (Maybe Text) -&gt; Maybe Text -&gt; IO ()
forall a. IORef a -&gt; a -&gt; IO ()
</span><span class="hs-identifier hs-var">writeIORef</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AsmInfo e -&gt; IORef (Maybe Text)
forall e. AsmInfo e -&gt; IORef (Maybe Text)
</span><a href="Htcc.Asm.Intrinsic.Structure.Internal.html#curFn"><span class="hs-identifier hs-var hs-var">curFn</span></a></span><span> </span><span class="annot"><span class="annottext">AsmInfo e
</span><a href="#local-6989586621679292210"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621679292211"><span class="hs-identifier hs-var">fname</span></a></span><span>
</span><span id="line-108"></span><span>
</span><span id="line-109"></span><span class="hs-comment">-- | represents a section of assembly code</span><span>
</span><span id="line-110"></span><span id="local-6989586621679292207"><span id="local-6989586621679292208"><span id="local-6989586621679292209"><span class="annot"><a href="Htcc.Asm.Intrinsic.Structure.Internal.html#section"><span class="hs-identifier hs-type">section</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Htcc.Asm.Intrinsic.Structure.Internal.html#Asm"><span class="hs-identifier hs-type">Asm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679292209"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679292208"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679292207"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Htcc.Asm.Intrinsic.Structure.Internal.html#Asm"><span class="hs-identifier hs-type">Asm</span></a></span><span> </span><span class="annot"><a href="Htcc.Asm.Intrinsic.Structure.Internal.html#AsmCodeCtx"><span class="hs-identifier hs-type">AsmCodeCtx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679292208"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679292207"><span class="hs-identifier hs-type">a</span></a></span></span></span></span><span>
</span><span id="line-111"></span><span id="section"><span class="annot"><span class="annottext">section :: Text -&gt; Asm ctx e a -&gt; Asm AsmCodeCtx e a
</span><a href="Htcc.Asm.Intrinsic.Structure.Internal.html#section"><span class="hs-identifier hs-var hs-var">section</span></a></span></span><span> </span><span id="local-6989586621679292206"><span class="annot"><span class="annottext">sec :: Text
</span><a href="#local-6989586621679292206"><span class="hs-identifier hs-var">sec</span></a></span></span><span> </span><span id="local-6989586621679292205"><span class="annot"><span class="annottext">asm :: Asm ctx e a
</span><a href="#local-6989586621679292205"><span class="hs-identifier hs-var">asm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Asm AsmCodeCtx e ()
forall ctx e. Text -&gt; Asm ctx e ()
</span><a href="Htcc.Asm.Intrinsic.Structure.Internal.html#putStrLnWithIndent"><span class="hs-identifier hs-var">putStrLnWithIndent</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-char">'.'</span></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Text -&gt; Text
</span><span class="hs-operator hs-var">`T.cons`</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679292206"><span class="hs-identifier hs-var">sec</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Asm AsmCodeCtx e () -&gt; Asm AsmCodeCtx e a -&gt; Asm AsmCodeCtx e a
forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b -&gt; f b
</span><span class="hs-operator hs-var">*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Asm ctx e a -&gt; Asm AsmCodeCtx e a
forall ctx e a ctx'. Asm ctx e a -&gt; Asm ctx' e a
</span><a href="Htcc.Asm.Intrinsic.Structure.Internal.html#unCtx"><span class="hs-identifier hs-var">unCtx</span></a></span><span> </span><span class="annot"><span class="annottext">Asm ctx e a
</span><a href="#local-6989586621679292205"><span class="hs-identifier hs-var">asm</span></a></span><span>
</span><span id="line-112"></span><span>
</span><span id="line-113"></span><span class="hs-comment">-- | switch to process in label</span><span>
</span><span id="line-114"></span><span id="local-6989586621679292202"><span id="local-6989586621679292203"><span id="local-6989586621679292204"><span class="annot"><a href="Htcc.Asm.Intrinsic.Structure.Internal.html#labeled"><span class="hs-identifier hs-type">labeled</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Htcc.Asm.Intrinsic.Structure.Internal.html#Asm"><span class="hs-identifier hs-type">Asm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679292204"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679292203"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679292202"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Htcc.Asm.Intrinsic.Structure.Internal.html#Asm"><span class="hs-identifier hs-type">Asm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679292204"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679292203"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679292202"><span class="hs-identifier hs-type">a</span></a></span></span></span></span><span>
</span><span id="line-115"></span><span id="labeled"><span class="annot"><span class="annottext">labeled :: Asm ctx e a -&gt; Asm ctx e a
</span><a href="Htcc.Asm.Intrinsic.Structure.Internal.html#labeled"><span class="hs-identifier hs-var hs-var">labeled</span></a></span></span><span> </span><span id="local-6989586621679292201"><span class="annot"><span class="annottext">asm :: Asm ctx e a
</span><a href="#local-6989586621679292201"><span class="hs-identifier hs-var">asm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(AsmInfo e -&gt; IO a) -&gt; Asm ctx e a
forall ctx e a. (AsmInfo e -&gt; IO a) -&gt; Asm ctx e a
</span><a href="Htcc.Asm.Intrinsic.Structure.Internal.html#Asm"><span class="hs-identifier hs-var">Asm</span></a></span><span> </span><span class="annot"><span class="annottext">((AsmInfo e -&gt; IO a) -&gt; Asm ctx e a)
-&gt; (AsmInfo e -&gt; IO a) -&gt; Asm ctx e a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679292200"><span class="annot"><span class="annottext">x :: AsmInfo e
</span><a href="#local-6989586621679292200"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Asm ctx e a -&gt; AsmInfo e -&gt; IO a
forall ctx e a. Asm ctx e a -&gt; AsmInfo e -&gt; IO a
</span><a href="Htcc.Asm.Intrinsic.Structure.Internal.html#unAsm"><span class="hs-identifier hs-var hs-var">unAsm</span></a></span><span> </span><span class="annot"><span class="annottext">Asm ctx e a
</span><a href="#local-6989586621679292201"><span class="hs-identifier hs-var">asm</span></a></span><span> </span><span class="annot"><span class="annottext">(AsmInfo e -&gt; IO a) -&gt; AsmInfo e -&gt; IO a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">AsmInfo e
</span><a href="#local-6989586621679292200"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">inLabel :: Bool
</span><a href="Htcc.Asm.Intrinsic.Structure.Internal.html#inLabel"><span class="hs-identifier hs-var">inLabel</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-116"></span></pre></body></html>